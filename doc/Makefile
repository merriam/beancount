#!/usr/bin/env schema

MODELS =					\
	beancount.sql				

.SUFFIXES: .txt .sql .db .create .test .clean .html

all: sql

docs:
	projects docs beancount

.txt.html:
	rst2html.py $< > $(<:.txt=.html)

sql: $(MODELS)

.txt.sql:
	-rm -f $@
	echo "-- This file is auto-generated by rst-literals. Do not modify." > $@
	rst-literals -t sql $< >> $@
	chmod a-w $@

.sql.clean:
	dropdb $(<:.sql=.db)

.sql.create:
	-dropdb $(<:.sql=.db) >/dev/null
	createdb $(<:.sql=.db)
	psql -f $< $(<:.sql=.db) 2>&1 | grep -v NOTICE:

.sql.test:
	psql -f $(<:.sql=test.sql) $(<:.sql=.db) 2>&1 | grep -v NOTICE:

examples:
	rst-literals -s accounting.txt >/dev/null

clean:
	rm -f $(MODELS)
