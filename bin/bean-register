#!/usr/bin/env python
"""
Print out the register of postings.
"""

# stdlib imports
import re, logging
from os.path import *

# beancount imports
from beancount import cmdline
from beancount.utils import render_tree
from beancount.wallet import Wallet


def main():
    import optparse
    parser = optparse.OptionParser(__doc__.strip())

    parser.add_option('-v', '--verbose', action='store_true',
                      help="Verbosely print some extra stuff.")

    cmdline.addopts(parser)
    opts, ledger, args = cmdline.main(parser)

    # Get the list of transactions that relate to the postings.
    balance = Wallet()
    for txn in ledger.transactions:
        for post in txn.postings:
            if post.selected:
                balance += post.amount

##         print post.fulldate(), post.txn.topline()
##         print post.pretty(ledger)
        print unicode(txn).encode('utf8')
        print '**********', balance.round()
        print


if __name__ == '__main__':
    main()




##     # Print a tree of the selected accounts.
##     if opts.verbose:
##         pred = lambda acc: getattr(acc, 'selected', 0)
##         print
##         for acc, branch, line in render_tree(ledger.get_root_account(), pred):
##             print branch + line
##         print
